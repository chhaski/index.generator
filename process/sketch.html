<!DOCTYPE html>
<html>
<head>
    <title>PDF & Text Viewer - Dataset Creation Process</title>
    <style>
        body {
            margin: 20px;
            font-family: Arial, sans-serif;
        }
        .view-controls {
            text-align: center;
            margin: 20px 0;
        }
        .view-controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .view-controls button.active {
            background: #0056b3;
        }
        .view-controls button:hover {
            background: #0056b3;
        }
        .pdf-container {
            margin-bottom: 30px;
            position: relative;
        }
        canvas {
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
        .text-view {
            display: none;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .text-view h3 {
            margin-top: 0;
            color: #495057;
        }
        .text-view pre {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            margin: 0;
            white-space: pre-wrap;
        }
        .pdf-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .overlay-controls {
            text-align: center;
            margin: 20px 0;
        }
        .overlay-controls button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .txt-overlay {
            position: absolute;
            background: rgba(0, 255, 0, 0.4);
            border: 1px solid #00ff00;
            padding: 2px 4px;
            font-family: 'Courier New', monospace;
            font-size: 8px;
            color: #000;
            pointer-events: none;
            z-index: 20;
            max-width: 200px;
            overflow: hidden;
        }
        .json-overlay {
            position: absolute;
            background: rgba(255, 0, 255, 0.4);
            border: 1px solid #ff00ff;
            padding: 2px 4px;
            font-family: 'Courier New', monospace;
            font-size: 8px;
            color: #000;
            pointer-events: none;
            z-index: 30;
            max-width: 200px;
            overflow: hidden;
        }
        .comparison-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .pdf-side, .txt-side {
            flex: 1;
        }
        .txt-content {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        .txt-content pre {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            margin: 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="view-controls">
        <button onclick="showPDFs()" class="active">Show PDFs with Overlays</button>
        <button onclick="showComparison()">Show PDF + .txt Comparison</button>
        <button onclick="showJSONEntries()">Show JSON Entries</button>
    </div>

    <div class="overlay-controls">
        <button onclick="toggleTextOverlay()">Toggle .txt Overlay</button>
        <button onclick="toggleJSONOverlay()">Toggle JSON Overlay</button>
    </div>

    <!-- PDF View -->
    <div id="pdf-view">
        <div class="pdf-container" id="chun-container">
            <div class="pdf-title">Chun - Updating to Remain the Same</div>
        </div>
    </div>

    <!-- Comparison View -->
    <div id="comparison-view" style="display: none;">
        <div class="comparison-container">
            <div class="pdf-side">
                <h3>PDF with Text Overlays</h3>
                <div class="pdf-container" id="chun-comparison-container">
                    <div class="pdf-title">Chun - Updating to Remain the Same</div>
                </div>
            </div>
            <div class="txt-side">
                <h3>Chun.txt Content</h3>
                <div class="txt-content" id="chun-txt-content">
                    <pre>Loading...</pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Text Files View -->
    <div id="text-view" class="text-view">
        <div id="chun-text">
            <h3>Chun.txt</h3>
            <pre id="chun-content">Loading...</pre>
        </div>
    </div>

    <!-- JSON Entries View -->
    <div id="json-view" class="text-view">
        <div id="chun-json">
            <h3>Chun JSON Entries</h3>
            <pre id="chun-json-content">Loading...</pre>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    
    <script>
        // PDF.js worker setup
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

        // PDF files with overlays
        const pdfFiles = [
            "../data/Chun_split_Text_Overlay.pdf"
        ];

        // Load and render PDFs
        async function loadPDFs() {
            await loadPDF(pdfFiles[0], 'chun-container');
        }

        async function loadPDF(pdfPath, containerId) {
            try {
                const container = document.getElementById(containerId);
                container.innerHTML = '<div class="pdf-title">Loading...</div>';
                
                const pdf = await pdfjsLib.getDocument(pdfPath).promise;
                const numPages = Math.min(pdf.numPages, 5); // Show first 5 pages
                
                container.innerHTML = '';
                
                for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    const viewport = page.getViewport({ scale: 1.0 });
                    
                    // Scale to fit with higher quality
                    const scale = Math.min(600 / viewport.width, 800 / viewport.height);
                    const scaledViewport = page.getViewport({ scale: scale });
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = scaledViewport.width;
                    canvas.height = scaledViewport.height;
                    container.appendChild(canvas);
                    
                    const context = canvas.getContext('2d');
                    const renderContext = {
                        canvasContext: context,
                        viewport: scaledViewport
                    };
                    
                    await page.render(renderContext).promise;
                    
                    // Add .txt overlays positioned to match the PDF text
                    addTextOverlays(container, scaledViewport, pageNum);
                }
                
                // Update container info
                const fileName = pdfPath.split('/').pop().replace('.pdf', '');
                const info = document.createElement('div');
                info.className = 'pdf-title';
                info.textContent = fileName.replace('_split_Text_Overlay', '') + ` - ${numPages} pages`;
                container.appendChild(info);
                
            } catch (error) {
                console.error('Error loading PDF:', error);
                const container = document.getElementById(containerId);
                container.innerHTML = '<div class="pdf-title" style="color: #b00;">Error loading PDF</div>';
            }
        }

        function addTextOverlays(container, viewport, pageNum) {
            // This is the key insight: we need to extract text positions from the PDF itself
            // and then position the .txt overlays to match exactly
            
            // For now, let's create a more intelligent positioning system
            // that tries to match the visual layout of the PDF text
            
            fetch('../data/Chun.txt')
                .then(response => response.text())
                .then(txtContent => {
                    const txtLines = txtContent.split('\n').filter(line => 
                        line.trim() && !line.startsWith('//') && !line.startsWith(']]')
                    );
                    
                    // Create a more realistic text layout that matches typical PDF text positioning
                    txtLines.slice(0, 30).forEach((line, index) => {
                        const overlay = document.createElement('div');
                        overlay.className = 'txt-overlay';
                        overlay.textContent = line.substring(0, 70);
                        
                        // Simulate realistic PDF text positioning
                        // Main entries get more space, sub-entries are indented
                        let xPos, yPos;
                        
                        if (line.includes(',')) {
                            // Main entry with page numbers
                            xPos = 80;
                            yPos = 120 + (index * 22);
                        } else if (line.startsWith(' ')) {
                            // Sub-entry (indented)
                            xPos = 100;
                            yPos = 120 + (index * 18);
                        } else {
                            // Regular entry
                            xPos = 80;
                            yPos = 120 + (index * 20);
                        }
                        
                        overlay.style.cssText = `
                            position: absolute;
                            left: ${xPos}px;
                            top: ${yPos}px;
                            width: 320px;
                            background: rgba(0, 255, 0, 0.4);
                            border: 1px solid #00ff00;
                            padding: 3px 6px;
                            font-size: 9px;
                            z-index: 20;
                            font-family: 'Courier New', monospace;
                            color: #000;
                        `;
                        
                        container.appendChild(overlay);
                    });
                });
        }

        function toggleTextOverlay() {
            const overlays = document.querySelectorAll('.txt-overlay');
            overlays.forEach(overlay => {
                overlay.style.display = overlay.style.display === 'none' ? 'block' : 'none';
            });
        }

        function toggleJSONOverlay() {
            const overlays = document.querySelectorAll('.json-overlay');
            overlays.forEach(overlay => {
                overlay.style.display = overlay.style.display === 'none' ? 'block' : 'none';
            });
        }

        // Load text files
        async function loadTextFiles() {
            try {
                const response = await fetch('../data/Chun.txt');
                const chunText = await response.text();
                
                document.getElementById('chun-content').textContent = chunText.substring(0, 2000) + '...';
                
            } catch (error) {
                console.error('Error loading text files:', error);
            }
        }

        // Load JSON entries
        async function loadJSONEntries() {
            try {
                const response = await fetch('../data/combinedv2_.json');
                const jsonData = await response.json();
                
                // Filter entries by source - only Chun
                const chunEntries = jsonData.filter(entry => entry.source_file === 'Chun').slice(0, 50);
                
                document.getElementById('chun-json-content').textContent = JSON.stringify(chunEntries, null, 2);
                
            } catch (error) {
                console.error('Error loading JSON:', error);
            }
        }

        // View switching functions
        function showPDFs() {
            document.getElementById('pdf-view').style.display = 'block';
            document.getElementById('text-view').style.display = 'none';
            document.getElementById('json-view').style.display = 'none';
            document.getElementById('comparison-view').style.display = 'none'; // Hide comparison view
            
            // Update button states
            document.querySelectorAll('.view-controls button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showComparison() {
            document.getElementById('pdf-view').style.display = 'none';
            document.getElementById('text-view').style.display = 'none';
            document.getElementById('json-view').style.display = 'none';
            document.getElementById('comparison-view').style.display = 'block';
            
            // Load both PDF and .txt content side by side
            loadPDF(pdfFiles[0], 'chun-comparison-container');
            loadTextFiles();
            
            // Update button states
            document.querySelectorAll('.view-controls button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showJSONEntries() {
            document.getElementById('pdf-view').style.display = 'none';
            document.getElementById('text-view').style.display = 'none';
            document.getElementById('json-view').style.display = 'none';
            document.getElementById('comparison-view').style.display = 'none';
            
            loadJSONEntries();
            
            // Update button states
            document.querySelectorAll('.view-controls button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadPDFs();
        });
    </script>
</body>
</html>